---
title: "Data Cleaning and Preparation for Cancer Epidemiology in New Caledonia"
author: "Naïma Beck and Axelle Le Poul"
output: 
  pdf_document: 
    latex_engine: xelatex
---

```{r}
#install.packages(c("tidyverse", "factoextra", "cluster", "caret"))
```

```{r}
library(tidyverse)
library(factoextra)
library(cluster)
library(caret)
```

# 1. Dataset and data overview

```{r}
epidemiology_cancers_nc_raw <- read.csv("../data/raw/epidemiologie_cancers_nc.csv", stringsAsFactors = FALSE)
head(epidemiology_cancers_nc_raw)
```

```{r}
unique(epidemiology_cancers_nc_raw$CLASSE_AGE)
```

```{r}
unique(epidemiology_cancers_nc_raw$indicateur)
```

```{r}
colnames(epidemiology_cancers_nc_raw)
```

```{r}
# On part du dataset original "epidemiology_cancers_nc_raw"
cim10_mapping <- epidemiology_cancers_nc_raw %>%
  select(CODE_CIM10, libelle_CIM10) %>%
  distinct()  # On ne garde qu’une ligne par code unique

cim10_mapping
```


# 2. Data cleaning and preparation

## 2.1 Deleting unnecessary columns 
```{r}
epidemiology_cancers_nc <- epidemiology_cancers_nc_raw %>%
  select(-id_row, -label, -libelle_CIM10)  
```

## 2.2 Encoding categorical variables

### Encodaging of binary variables : 'sexe' and 'indicateur'
```{r}
epidemiology_cancers_nc$SEXE <- ifelse(epidemiology_cancers_nc$SEXE == "Homme", 1, 0) # 1: Homme, 0:Femme

epidemiology_cancers_nc$indicateur <- ifelse(epidemiology_cancers_nc$indicateur == "Mortalité", 1, 0) # 1: Mortalité, 0: Incidence
```

### Dummy encoding

It is encoding categorial variables into numerical variables.

```{r}
categorical_vars <- c( "CLASSE_AGE", "CODE_CIM10")
col_encoded <- dummyVars(" ~ .", data = epidemiology_cancers_nc[, categorical_vars]) %>%
  predict(newdata = epidemiology_cancers_nc[, categorical_vars]) %>%
  as.data.frame()
```

### combine the encoded columns and the numerical columns
```{r}
numeric_vars <- epidemiology_cancers_nc %>%
  select(-all_of(categorical_vars))
epidemiology_cancers_nc <- cbind(numeric_vars, col_encoded)

head(epidemiology_cancers_nc)
```

## 2.3 Handling missing values

To see how many missing values we have in the dataset : 

### Counting missing values
```{r}
sum(is.na(epidemiology_cancers_nc))
```
They are a lot of missing values in this data set, let's look at the proportion of missing values in the columns so we can take a decision.

### number of rows(observations) in the dataset
```{r}
nrow(epidemiology_cancers_nc)
```

### missing values per column
```{r}
na_per_column <- colSums(is.na(epidemiology_cancers_nc))
na_pct_per_column <- colSums(is.na(epidemiology_cancers_nc)*100/nrow(epidemiology_cancers_nc))

cat("--- Number of NA per colonne ---\n")
head(sort(na_per_column, decreasing = TRUE))

cat("\n--- Pourcentage of NA per colonne (%) ---\n")
head(sort(na_pct_per_column, decreasing = TRUE))
```
We can see that in the column 'age_median' we have 83% of missing values. So we may delete this column. And for the column 'frequence' we only have 2% of missing values so we may delete the observations with missing frequence.


### We delete the columns 'age_median'
```{r}
epidemiology_cancers_nc <-  epidemiology_cancers_nc %>%
select(-age_median)
```

### We delete the rows where the frequence is missing
```{r}
epidemiology_cancers_nc <- epidemiology_cancers_nc[complete.cases(epidemiology_cancers_nc), ]
```

### verification of the number of missing values in the data set
```{r}
sum(is.na(epidemiology_cancers_nc))
```
```{r}
head(epidemiology_cancers_nc)
```

# 3. Exporting cleaned data
```{r}
write.csv(epidemiology_cancers_nc,"../data/processed/epidemiologie_cancers_nc_clean.csv",
          row.names = FALSE)
```
